<!DOCTYPE html>
<html lang="en">
  {% include 'head.html' %}

  <body>
    <!-- Navbar -->
    <nav class="navbar is-fixed-top" role="navigation" aria-label="main navigation">
      <div class="navbar-brand">
        <a class="navbar-item" href="{{ catalog.base_url }}">
          <img src="{{ path_prefix }}{{ catalog.image }}" width="28" height="28"
               alt="{{ catalog.title }} logo">
        </a>
    
        <a role="button" class="navbar-burger burger" aria-label="menu" aria-expanded="false" data-target="ssNavBarTop" 
        onclick="document.querySelector('.navbar-menu').classList.toggle('is-active');">
          <span aria-hidden="true"></span>
          <span aria-hidden="true"></span>
          <span aria-hidden="true"></span>
        </a>
      </div>

      <div id="appimage-navbar" class="navbar-menu">
        <div class="navbar-start">
          <a class="navbar-item" href="{{ catalog.base_url}}/">
            Home
          </a>
          <a class="navbar-item" href="{{ catalog.base_url}}/all/">
            All AppImages
          </a>
          <a class="navbar-item" href="{{ catalog.base_url}}/search/">
            Search
          </a>
          <div class="navbar-item has-dropdown is-hoverable">
            <a class="navbar-link" href="#"  onclick="return false;">
              More
            </a>
    
            <div class="navbar-dropdown">
              <a class="navbar-item" href="#about">
                About
              </a>
              <a class="navbar-item" href="#contact">
                Contact
              </a>
              <hr class="navbar-divider">
              <a class="navbar-item" href="{{ catalog.issue_tracker }}">
                Report an issue
              </a>
            </div>
          </div>
        </div>
    
        <div class="navbar-end">
          <div class="navbar-item">
            <div class="field" style="margin: 0.5em;">
              <input id="themeSwitch" type="checkbox" name="switchRoundedDefault" class="switch is-rounded">
              <label for="themeSwitch">
                <i class="fa fa-sun"></i><span class="sr-only">Light Mode</span>
              </label>
            </div>

          </div>
        </div>
      </div>
    </nav>

    <!-- Hero / Featured Header -->
    <section style="margin-top: 3.25em;" class="hero is-medium is-bold has-text-centered">
      <div class="hero-body">
        <div class="container">
          <img class="appimage-hero-img" src="{{ path_prefix }}{{ catalog.image }}"
               alt="Appimage logo">
          <h1 class="title">
            {{ catalog.title }}
          </h1>
          <h2 class="subtitle">
            {{ catalog.description }}
          </h2>
          <form id="appimage-search-container" action="./search/" method="GET">
            <div class="form-row">
              <input id="appimage-search-box"
                class="input appimage-search-input"
                placeholder="Search for AppImages!"
                autofocus name="q"
              />
              <button class="button is-success" type="submit" style="margin-left: 15px;width: 48px;height: 48px;border-radius:50%">
                <i class="fa fa-search"></i>
              </button>

            </div>
          </form>


        </div>
      </div>
    </section>

    <!-- All the other code comes here! -->

    <!-- Appimages card sections -->
    <section id="apps" class="section" style="max-width: 1380px; margin: 0
    auto;">
      <div class="grid">
        <div class="grid__col-sizer"></div>
        <div class="grid__gutter-sizer"></div>
        {{ cards }}
      </div>

      {% if next_page_link %}
      <p style="display: none"><a class="pagination__next"
            href="{{ path_prefix }}/all{{ next_page_link }}">Next</a>
      </p>
      {% endif %}

      <div class="scroll-status">
        <div class="infinite-scroll-request">
          <div class="loader-ellips">
            <span class="loader-ellips__dot loader-ellips__dot--1"></span>
            <span class="loader-ellips__dot loader-ellips__dot--2"></span>
            <span class="loader-ellips__dot loader-ellips__dot--3"></span>
            <span class="loader-ellips__dot loader-ellips__dot--4"></span>
          </div>
        </div>
        <p class="infinite-scroll-error has-text-centered">No more pages to load</p>
        <p class="infinite-scroll-last has-text-centered">Last page loaded</p>
      </div>

    </section>


    <!-- Scripts -->
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="https://unpkg.com/imagesloaded@4/imagesloaded.pkgd.min.js"></script>
    <script src="https://unpkg.com/masonry-layout@4/dist/masonry.pkgd.min.js"></script>
    <script src="https://unpkg.com/infinite-scroll@3/dist/infinite-scroll.pkgd.min.js"></script>
    <script src="{{ path_prefix }}/js/utils.js"></script>
    <script>
        
      function darkTheme() {
        $(":root").get(0).style.setProperty("--foreground-color", "#ffffff");
        $(":root").get(0).style.setProperty("--foreground-color-2", "#fafafa");
        $(":root").get(0).style.setProperty("--background-color", " #121212");
        $(":root").get(0).style.setProperty("--background-color-2", " #000000");
        $("label[for='themeSwitch']").html('<i class="fa fa-moon"></i><span class="sr-only">Dark Mode</span>')
        $('#themeSwitch').prop('checked', true);
        $("#bulma").attr("src","{{ path_prefix }}/img/made-with-bulma--white.png");
        $(":root").get(0).style.setProperty("--cth", "0");
      }

      function lightTheme() {
        $(":root").get(0).style.setProperty("--foreground-color", "#000");
        $(":root").get(0).style.setProperty("--foreground-color-2", "#121212");
        $(":root").get(0).style.setProperty("--background-color", " #fafafa");
        $(":root").get(0).style.setProperty("--background-color-2", " #ffffff");
        $("label[for='themeSwitch']").html('<i class="fa fa-sun"></i><span class="sr-only">Light Mode</span>')
        $('#themeSwitch').prop('checked', false);
        $("#bulma").attr("src","{{ path_prefix }}/img/made-with-bulma--black.png");
        $(":root").get(0).style.setProperty("--cth", "255");
      }

      $(document).ready(function(){
        const userPrefersDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;

        if ( userPrefersDark ) {
            darkTheme();
        }

        $('#themeSwitch').change(function() {
          if (this.checked) {
            darkTheme();
          } else {
            lightTheme();
          }
        });

        var msnry = new Masonry( '.grid', {
          itemSelector: 'none', // select no images on init
          columnWidth: '.grid__col-sizer',
          gutter: '.grid__gutter-sizer',
          percentPosition: true,
          stagger: 30,
          fitWidth: true,
          visibleStyle: {
            transform: 'translateY(0)',
            opacity: 1
          },
          hiddenStyle: {
            transform: 'translateY(100px)',
            opacity: 0,
          }
        });

        imagesLoaded( '.grid', function() {
          msnry.options.itemSelector = '.grid__item'; // select proper items
          document.querySelector('.grid').classList.add('are-images-ready');
          var items = document.querySelectorAll('.grid__item');
          msnry.appended( items );
        });

        var infScroll = new InfiniteScroll( '.grid', {
          path: '.pagination__next',
          append: '.grid__item',
          debug: true,
          outlayer: msnry,
          status: '.scroll-status',
          scrollThreshold: 1,
        });

        infScroll.loadNextPage();
      });
    </script>

  </body>
  {% include 'footer.html' %}


</html>